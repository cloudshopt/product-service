openapi: 3.0.3
info:
  title: CloudShopt Product Service API
  version: 1.0.0
tags:
  - name: Diagnostics
  - name: Products

paths:
  /info:
    get:
      tags: [Diagnostics]
      summary: Service info (sha, time)
      responses:
        "200":
          description: Info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InfoResponse"

  /database:
    get:
      tags: [Diagnostics]
      summary: Database connectivity check
      responses:
        "200":
          description: DB OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DatabaseOkResponse"
        "500":
          description: DB connection failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DatabaseFailResponse"

  /items:
    get:
      tags: [Products]
      summary: List products
      responses:
        "200":
          description: Products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductListResponse"

  /items/{id}:
    get:
      tags: [Products]
      summary: Get product detail
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: Product
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "404":
          $ref: "#/components/responses/NotFound"

components:
  responses:
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorMessage"
          example:
            message: "Not found"

  schemas:
    ErrorMessage:
      type: object
      required: [message]
      properties:
        message:
          type: string

    InfoResponse:
      type: object
      required: [ok, service, sha, time]
      properties:
        ok:
          type: boolean
          example: true
        service:
          type: string
          example: product-service
        sha:
          type: string
          nullable: true
          example: 0.0.1
        time:
          type: string
          format: date-time
          example: "2026-01-29T10:15:30.123Z"

    DatabaseOkResponse:
      type: object
      required: [ok, db, time]
      properties:
        ok:
          type: boolean
          example: true
        db:
          type: object
          required: [connection, database, ping_ms]
          properties:
            connection:
              type: string
              example: mysql
            database:
              type: string
              example: cloudshopt_products_dev
            ping_ms:
              type: number
              format: float
              example: 1.25
        time:
          type: string
          format: date-time
          example: "2026-01-29T10:15:30.123Z"

    DatabaseFailResponse:
      type: object
      required: [ok, error, message]
      properties:
        ok:
          type: boolean
          example: false
        error:
          type: string
          example: DB connection failed
        message:
          type: string
          nullable: true
          example: "SQLSTATE[HY000] ..."

    Product:
      type: object
      required: [id, name, price]
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: CloudShopt T-Shirt
        description:
          type: string
          nullable: true
          example: Basic tee for everyday wear.
        price:
          type: integer
          description: Price in cents
          example: 1990
        image_url:
          type: string
          nullable: true
          example: null

    ProductResponse:
      type: object
      required: [data]
      properties:
        data:
          $ref: "#/components/schemas/Product"

    ProductListResponse:
      type: object
      required: [data]
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Product"